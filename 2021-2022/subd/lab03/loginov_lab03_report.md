### **РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ НАРОДОВ**

### **Факультет физико-математических и естественных наук**

### **Кафедра прикладной информатики и теории вероятностей**











### **Отчет по лабораторной работе № 3**

### *Дисциплина: Системы управления базами данных*









Студент:	Логинов Сергей Андреевич

Группа:	  НФИбд-01-18 



​																							

​															**МОСКВА 2021г**

### Задание

**Блокировка транзакций**

1. Начните одну транзакцию и в ней измените определенную запись в таблице, затем приостановите выполнение на 20-30 секунд. В другой сессии попробуйте вначале сделать *select*, а затем *update* изменяемой записи, покажите в каком случае произойдет блокировка (или нет)
2. Начните одну транзакцию и в ней измените определенную запись в таблице, затем приостановите выполнение на 20-30 секунд. В другой сессии попробуйте вначале сделать *select*, а затем *update* другой записи, покажите в каком случае произойдет блокировка (или нет)

### Выполнение

Для старта транзакции будем использовать *begin transaction*, для завершения транзакции и внесения изменения используем *commit*.

По сути, транзакция помогает решать те ситуации, когда бд находится в таком состоянии, что часть изменений в данных уже выполнена, но осталась еще, скажем, необработанная часть. Это может приводить к ошибкам и проблемам. Также транзакции предотвращают различные сбои, поскольку все изменения станут постоянными только после завершения транзакции. Предполагаю, что при использовании транзакции должно быть заблокировано любое параллельное изменение данных в таблице.



1. Начните одну транзакцию и в ней измените определенную запись в таблице, затем приостановите выполнение на 20-30 секунд. В другой сессии попробуйте вначале сделать *select*, а затем *update* изменяемой записи, покажите в каком случае произойдет блокировка (или нет)

Создадим базу данных для третьей лабораторной работы и таблицу squares в ней:

![Снимок экрана 2021-12-09 в 00.48.01](/Users/sergejloginov/Library/Application Support/typora-user-images/Снимок экрана 2021-12-09 в 00.48.01.png)

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.16.45.png" alt="Снимок экрана 2021-12-09 в 01.16.45" style="zoom:50%;" />

Для начала попробуем не завершая транзакцию изменить используемое в транзакции значение в параллельной сессии:

1 сессия

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.08.40.png" alt="Снимок экрана 2021-12-09 в 01.08.40" style="zoom:50%;" />



2 сессия

<img src="/Users/sergejloginov/Library/Application Support/typora-user-images/Снимок экрана 2021-12-09 в 01.18.17.png" alt="Снимок экрана 2021-12-09 в 01.18.17" style="zoom:50%;" />

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.08.53.png" alt="Снимок экрана 2021-12-09 в 01.08.53" style="zoom:50%;" />



Вывод: транзакция не препятствует чтению значения, но она заблокировала обновление значения в параллельной сессии, обновление состоится после команды commit или rollback в первой сессии

То же самое с завершением транзакции и командой pg_sleep:

1 сессия

![Снимок экрана 2021-12-09 в 01.23.04](/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.23.04.png)

2 сессия

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.24.37.png" alt="Снимок экрана 2021-12-09 в 01.24.37" style="zoom:50%;" />

![Снимок экрана 2021-12-09 в 01.24.45](/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.24.45.png)



Результаты аналогичные, значение можно прочитать и нельзя перезаписать.

2. Начните одну транзакцию и в ней измените определенную запись в таблице, затем приостановите выполнение на 20-30 секунд. В другой сессии попробуйте вначале сделать *select*, а затем *update* другой записи, покажите в каком случае произойдет блокировка (или нет)

Сначала так же без завершения транзакции:

1 сессия

<img src="/Users/sergejloginov/Library/Application Support/typora-user-images/Снимок экрана 2021-12-09 в 01.54.35.png" alt="Снимок экрана 2021-12-09 в 01.54.35" style="zoom:50%;" />

2 сессия, чтение

<img src="/Users/sergejloginov/Library/Application Support/typora-user-images/Снимок экрана 2021-12-09 в 01.55.13.png" alt="Снимок экрана 2021-12-09 в 01.55.13" style="zoom:50%;" />

запись

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 01.56.13.png" alt="Снимок экрана 2021-12-09 в 01.56.13" style="zoom:50%;" />

Даже с незавершенной транзакцией нам удалось прочитать и изменить другое значение таблицы. В данном случае блокируются только изменения значения из транзакции.



С завершением транзакции и pg_sleep:

1 сессия

![Снимок экрана 2021-12-09 в 02.01.41](/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 02.01.41.png)



2 сессия чтение

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 02.01.49.png" alt="Снимок экрана 2021-12-09 в 02.01.49" style="zoom:50%;" />

запись

<img src="/Users/sergejloginov/Library/Mobile Documents/com~apple~CloudDocs/Снимок экрана 2021-12-09 в 02.02.21.png" alt="Снимок экрана 2021-12-09 в 02.02.21" style="zoom:50%;" />



В данном случае все аналогично, транзакция не препятствует изменению других значений



**Вывод:** в данной лабораторной работе на практике изучили принцип работы транзакций и их блокировки. Транзакция выступает как атомарная операция, которая либо будет завершена полностью, либо не будет выполнена вовсе. При этом данные обновляются только после успешного завершения (коммита). Также транзакция блокирует любые параллельные изменения значений, которые используются в транзакции, но не блокирует чтение этих значений.
